<!-- Root container for the Target System Page -->
<div>
  <p-toast key="targetPage"></p-toast>
  <p-tabView *ngIf="selectedSystem">

    <!-- Tab for viewing and editing base system information -->
    <p-tabPanel header="System">

      <div class="flex align-items-center gap-3">
        <label class="text-xl font-bold" style="line-height: 3rem;">System Name:</label>
        <span>
          <p-inplace #inplace (onActivate)="onInplaceActivate()" styleClass="flex align-items-center">
          <ng-template pTemplate="display">
            <span class="text-xl font-semibold">{{ selectedSystem?.name }}</span>
          </ng-template>

          <ng-template pTemplate="content" let-closeCallback="closeCallback">
      <span class="inline-flex align-items-center gap-2">
        <input
          type="text"
          [(ngModel)]="selectedSystem!.name"
          pInputText
          autofocus
          (keyup.enter)="onSave(closeCallback)"/>
        <p-button icon="pi pi-times" aria-label="Cancel" (click)="onClose(closeCallback)" text severity="danger"/>
        <p-button icon="pi pi-check" aria-label="Save" (click)="onSave(closeCallback)" text severity="success"/>
      </span>
          </ng-template>
        </p-inplace>
                  </span>

      </div>

      <div class="flex align-items-center gap-3">
        <label class="text-xl font-bold" style="line-height: 3rem;">Api address:</label>
        <span>
          <p-inplace #inplace (onActivate)="onInplaceActivate()" styleClass="flex align-items-center">
          <ng-template pTemplate="display">
            <span class="text-xl font-semibold">{{ selectedSystem?.apiUrl }}</span>
          </ng-template>

          <ng-template pTemplate="content" let-closeCallback="closeCallback">
      <span class="inline-flex align-items-center gap-2">
        <input
          type="text"
          [(ngModel)]="selectedSystem!.apiUrl"
          pInputText
          autofocus
          (keyup.enter)="onSave(closeCallback)"/>
        <p-button icon="pi pi-times" aria-label="Cancel" (click)="onClose(closeCallback)" text severity="danger"/>
        <p-button icon="pi pi-check" aria-label="Save" (click)="onSave(closeCallback)" text severity="success"/>
      </span>
          </ng-template>
        </p-inplace>
                  </span>

      </div>

      <div class="flex align-items-center gap-3" style="margin-top: 1rem;">
        <label class="text-xl font-bold" style="line-height: 3rem;">Description:</label>
        <span>
          <p-inplace #inplace (onActivate)="onInplaceActivate()" styleClass="flex align-items-center">
          <ng-template pTemplate="display">
            <span class="text-xl font-semibold">{{ selectedSystem?.description || '-' }}</span>
          </ng-template>

          <ng-template pTemplate="content" let-closeCallback="closeCallback">
      <span class="inline-flex align-items-center gap-2">
        <textarea
          [(ngModel)]="selectedSystem!.description"
          pInputTextarea
          rows="3"
          autofocus
          style="min-width: 400px;"></textarea>
        <p-button icon="pi pi-times" aria-label="Cancel" (click)="onClose(closeCallback)" text severity="danger"/>
        <p-button icon="pi pi-check" aria-label="Save" (click)="onSave(closeCallback)" text severity="success"/>
      </span>
          </ng-template>
        </p-inplace>
                  </span>

      </div>

    </p-tabPanel>
    <!-- Tab for managing custom API headers -->
    <p-tabPanel *ngIf="!isAasSelected()" header="Headers">
      <app-manage-api-headers [syncSystemId]="selectedSystem!.id!" [allowValues]="true"></app-manage-api-headers>
    </p-tabPanel>
    <!-- Tab for managing REST API endpoints -->
    <p-tabPanel *ngIf="!isAasSelected()" header="Endpoints">
      <app-manage-target-endpoints [targetSystemId]="selectedSystem!.id!"></app-manage-target-endpoints>
    </p-tabPanel>
    <!-- Tab for configuring AAS connection details and testing connectivity -->
    <p-tabPanel *ngIf="isAasSelected()" header="AAS Configuration">
      <div class="p-grid p-fluid">
        <div class="p-col-12 p-md-6">
          <label>Base URL</label>
          <input pInputText [value]="selectedSystem!.apiUrl" disabled/>
        </div>
        <div class="p-col-12 p-md-6">
          <label>AAS ID</label>
          <input pInputText [(ngModel)]="selectedSystem!.aasId" placeholder="AAS Identifier"/>
        </div>
      </div>
      <div class="p-d-flex p-ai-center" style="margin-top: .75rem; gap: .5rem;">
        <button pButton type="button" label="Test" (click)="aasTest()" [disabled]="aasTestLoading"></button>
        <span *ngIf="aasTestLoading">Testing...</span>
        <small *ngIf="aasTestError" style="color:#d32f2f;">{{ aasTestError }}</small>
      </div>
    </p-tabPanel>
    <!-- Tab for managing AAS (Asset Administration Shell) -->
    <p-tabPanel *ngIf="isAasSelected()" header="AAS Management">
      <app-aas-management [system]="selectedSystem" (refreshRequested)="onAasRefreshRequested()"></app-aas-management>
    </p-tabPanel>
  </p-tabView>

</div>

