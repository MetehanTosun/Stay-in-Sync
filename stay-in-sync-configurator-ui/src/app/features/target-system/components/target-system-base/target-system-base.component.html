<app-search-bar
  [customPlaceholder]="'Search target systems by name, description, API URL...'"
  (search)="onSearchChange($event)"
  (clear)="onSearchClear()">
</app-search-bar>

<p-table [value]="displaySystems" [loading]="loading" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'">
  <ng-template #caption>
    <div class="flex items-center justify-between">
      <span class="text-xl font-bold">Target Systems</span>
      <button pButton type="button" label="Create Target System" icon="pi pi-plus" (click)="openCreate()"></button>
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 25%;">
        <div class="column-header">
          <span>Name</span>
          <div class="search-indicator" *ngIf="false">
            <i class="pi pi-search" title="Name matches found"></i>
          </div>
        </div>
      </th>
      <th style="width: 25%;">
        <div class="column-header">
          <span>API URL</span>
          <div class="search-indicator" *ngIf="false">
            <i class="pi pi-search" title="URL matches found"></i>
          </div>
        </div>
      </th>
      <th style="width: 25%;">
        <div class="column-header">
          <span>Description</span>
          <div class="search-indicator" *ngIf="false">
            <i class="pi pi-search" title="Description matches found"></i>
          </div>
        </div>
      </th>
      <th style="width: 25%;">
        <div class="column-header">
          <span>Actions</span>
          <div class="search-indicator" *ngIf="false">
            <i class="pi pi-cog" title="Endpoint/Header matches found"></i>
          </div>
        </div>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-system let-rowIndex="rowIndex">
    <tr [class.search-result]="isSearchActive">
      <td>
        <div class="system-name-cell">
          <div class="system-name">{{ system.name }}</div>
        </div>
      </td>
      <td>
        <div class="api-url-cell">
          <div class="api-url">{{ system.apiUrl }}</div>
          <div class="api-type" *ngIf="system.apiType">
            <span class="api-type-badge">{{ system.apiType }}</span>
          </div>
        </div>
      </td>
      <td>
        <div class="description-cell">
          <div class="description-text">{{ system.description }}</div>
        </div>
      </td>
      <td>
        <div class="actions-cell">
          <button pButton type="button" label="Manage" class="p-button-text p-button-sm" (click)="manage(system)"></button>
          <button pButton type="button" icon="pi pi-trash" class="p-button-text p-button-sm p-button-danger" (click)="confirmDelete(system)"></button>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="4">
        <div class="empty-state" style="text-align:center; padding: 2rem 0;">
          <div class="empty-icon" style="margin-bottom:.5rem;">
            <i class="pi pi-database"></i>
          </div>
          <div class="empty-message">
            <h4>No target systems available</h4>
            <p>No target systems available. Create your first target system to get started.</p>
          </div>
          <div class="empty-actions" style="margin-top: .75rem;">
            <button pButton type="button" label="Create Target System" icon="pi pi-plus" (click)="openCreate()"></button>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog [(visible)]="showDialog" [modal]="true" [style]="{width: '900px'}" [header]="dialogTitle">
  <form [formGroup]="form" class="p-fluid">
    <div class="p-field">
      <label for="name">Name</label>
      <input id="name" pInputText formControlName="name">
    </div>
    <div class="p-field">
      <label for="apiUrl">API URL</label>
      <input id="apiUrl" pInputText formControlName="apiUrl">
    </div>
    <div class="p-field">
      <label for="apiType">API Type</label>
      <input id="apiType" pInputText formControlName="apiType">
    </div>
    <div class="p-field">
      <label for="description">Description</label>
      <input id="description" pInputText formControlName="description">
    </div>
  </form>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" class="p-button-text" (click)="closeDialog()"></button>
    <button pButton label="Open Wizard" (click)="openWizard()" [disabled]="form.invalid"></button>
  </ng-template>
</p-dialog>

<app-create-target-system [(visible)]="wizardVisible"></app-create-target-system>

<p-dialog [(visible)]="showDetailDialog" [modal]="true" [style]="{ width: '80vw', height: '80vh' }" header="Manage Target System">
  <div class="p-grid p-dir-col">
    <div class="p-col" style="margin-bottom: 2rem;">
      <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem; font-weight: 600;">Metadata</h3>
      <form *ngIf="manageForm" [formGroup]="manageForm" class="p-fluid" (ngSubmit)="saveManagedMetadata()">
        <div class="p-field" style="margin-bottom: 1rem;">
          <label for="m_name" style="font-weight: 500; margin-bottom: 0.5rem; display: block;">Name*</label>
          <input id="m_name" pInputText formControlName="name" style="width: 100%;" />
        </div>
        <div class="p-field" style="margin-bottom: 1rem;">
          <label for="m_apiUrl" style="font-weight: 500; margin-bottom: 0.5rem; display: block;">API URL*</label>
          <input id="m_apiUrl" pInputText formControlName="apiUrl" style="width: 100%;" />
        </div>
        <div class="p-field" style="margin-bottom: 1rem;">
          <label for="m_description" style="font-weight: 500; margin-bottom: 0.5rem; display: block;">Description</label>
          <textarea id="m_description" pInputTextarea rows="3" formControlName="description" style="width: 100%;"></textarea>
        </div>
        <div class="p-field" style="margin-bottom: 1rem;">
          <button pButton type="submit" label="Save Metadata" [disabled]="manageForm.invalid"></button>
        </div>
      </form>
    </div>
    <p-tabView>
      <p-tabPanel *ngIf="!isAasSelected()" header="Headers & Endpoints">
        <div class="p-grid" style="margin: 1rem 0;">
          <div class="p-col-12 p-md-6" style="padding: 0.5rem;">
            <p-card [style]="{'height': '100%'}">
              <h4 style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">API Headers</h4>
              <app-manage-api-headers *ngIf="selectedSystem" [syncSystemId]="selectedSystem.id!"></app-manage-api-headers>
            </p-card>
          </div>
          <div class="p-col-12 p-md-6" style="padding: 0.5rem;">
            <p-card [style]="{'height': '100%'}">
              <h4 style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">Target Endpoints</h4>
              <app-manage-target-endpoints *ngIf="selectedSystem" [targetSystemId]="selectedSystem.id!" (finish)="onManageFinished()"></app-manage-target-endpoints>
            </p-card>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel *ngIf="isAasSelected()" header="AAS Management">
        <app-aas-management [system]="selectedSystem" (refreshRequested)="onAasRefreshRequested()"></app-aas-management>
      </p-tabPanel>
    </p-tabView>
  </div>
</p-dialog>
<app-confirmation-dialog
  [(visible)]="showConfirmationDialog"
  [data]="confirmationData"
  (confirmed)="onConfirmationConfirmed()"
  (cancelled)="onConfirmationCancelled()">
</app-confirmation-dialog>

