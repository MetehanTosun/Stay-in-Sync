<div style="height: 50rem">
<p-table [value]="displaySystems" [paginator]="true"
         [paginator]="true"
         paginatorPosition="bottom"
         [rows]="10"
         [scrollable]="true"
         scrollHeight="flex">
  <ng-template pTemplate="header">
    <tr>
      <th>Name</th>
      <th>API URL</th>
      <th>Description</th>
      <th>Actions</th>
    </tr>
    <tr>
      <th>
        <p-columnFilter type="text" field="name" matchMode="contains" placeholder="Search by name" [showMenu]="false"
                        ariaLabel="Filter Name"></p-columnFilter>
      </th>
      <th>
        <p-columnFilter type="text" field="apiUrl" matchMode="contains" placeholder="Search by address"
                        ariaLabel="Filter Name"></p-columnFilter>
      </th>
      <th></th>
      <th>
      </th>
    </tr>
  </ng-template>
  <ng-template #caption>
    <div class="flex items-center justify-between">
      <span class="text-xl font-bold">Target Systems</span>
      <button pButton type="button" label="Create Target System" icon="pi pi-plus" (click)="openCreate()"></button>
    </div>
  </ng-template>
  <ng-template pTemplate="body" let-row>
    <tr>
      <td>{{ row.name }}</td>
      <td>
        <div class="api-url-cell">
          <div class="api-url">{{ row.apiUrl }}</div>
          <div class="api-type" *ngIf="row.apiType">
            <span class="api-type-badge">{{ row.apiType }}</span>
          </div>
        </div>
      </td>
      <td>{{ row.description }}</td>
      <td>
        <button pButton label="Manage" class="p-button-text p-button-sm" (click)="manage(row)"></button>
        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger" (click)="confirmDelete(row)"></button>
      </td>
    </tr>

  </ng-template>
</p-table>

<p-dialog [(visible)]="showDialog" [modal]="true" [style]="{width: '900px'}" [header]="dialogTitle">
  <form [formGroup]="form" class="p-fluid">
    <div class="p-field">
      <label for="name">Name</label>
      <input id="name" pInputText formControlName="name">
    </div>
    <div class="p-field">
      <label for="apiUrl">API URL</label>
      <input id="apiUrl" pInputText formControlName="apiUrl">
    </div>
    <div class="p-field">
      <label for="apiType">API Type</label>
      <input id="apiType" pInputText formControlName="apiType">
    </div>
    <div class="p-field">
      <label for="description">Description</label>
      <input id="description" pInputText formControlName="description">
    </div>
  </form>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" class="p-button-text" (click)="closeDialog()"></button>
    <button pButton label="Open Wizard" (click)="openWizard()" [disabled]="form.invalid"></button>
  </ng-template>
</p-dialog>

<app-create-target-system [(visible)]="wizardVisible"></app-create-target-system>

<p-dialog [(visible)]="showDetailDialog" [modal]="true" [style]="{ width: '80vw', height: '80vh' }" header="Manage Target System">
  <div class="p-grid p-dir-col">
    <div class="p-col">
      <h3 class="p-mb-2">Metadata</h3>
      <form *ngIf="manageForm" [formGroup]="manageForm" class="p-fluid p-formgrid p-grid" (ngSubmit)="saveManagedMetadata()">
        <div class="p-field p-col-12 p-md-6">
          <label for="m_name">Name</label>
          <input id="m_name" pInputText formControlName="name" />
        </div>
        <div class="p-field p-col-12 p-md-6">
          <label for="m_apiUrl">API URL</label>
          <input id="m_apiUrl" pInputText formControlName="apiUrl" />
        </div>
        <!-- spacer row between metadata rows -->
        <div class="p-col-12" style="height: 1rem;"></div>
        <div class="p-field p-col-12 p-md-6">
          <label for="m_apiType">API Type</label>
          <input id="m_apiType" pInputText formControlName="apiType" />
        </div>
        <div class="p-field p-col-12">
          <label for="m_description">Description</label>
          <textarea id="m_description" pInputTextarea rows="3" formControlName="description"></textarea>
        </div>
        <div class="p-col-12">
          <button pButton type="submit" label="Save Metadata" [disabled]="manageForm.invalid"></button>
        </div>
      </form>
    </div>
    <div class="p-col p-mt-4">
      <h3 class="p-mb-2">API Headers</h3>
      <app-manage-api-headers *ngIf="selectedSystem" [syncSystemId]="selectedSystem.id!"></app-manage-api-headers>
    </div>
    <div class="p-col p-mt-4">
      <h3 class="p-mb-2">Endpoints</h3>
      <app-manage-target-endpoints *ngIf="selectedSystem" [targetSystemId]="selectedSystem.id!" (finish)="onManageFinished()"></app-manage-target-endpoints>
    </div>
  </div>
</p-dialog>
<app-confirmation-dialog
  [(visible)]="showConfirmationDialog"
  [data]="confirmationData"
  (confirmed)="onConfirmationConfirmed()"
  (cancelled)="onConfirmationCancelled()">
</app-confirmation-dialog>
</div>
