<!-- MARK: Page Header -->
<p-toolbar class="mb-3">
  <div class="p-toolbar-group-left">
    <h2>Synchronization Rules</h2>
  </div>
  <div class="p-toolbar-group-right flex gap-2">
    <input
      pInputText
      type="text"
      [(ngModel)]="searchTerm"
      placeholder="Search by rule name..."
    />
    <p-button
      label="Create new Rule"
      icon="pi pi-plus"
      (click)="openCreateRuleModal()"
      id="create-button"
    ></p-button>
  </div>
</p-toolbar>

<!-- MARK: Table -->
<p-table
  [value]="filteredRules"
  [loading]="isLoading"
  [paginator]="true"
  [rows]="10"
  responsiveLayout="scroll"
>
  <!-- Table Header -->
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="name">
        Name <p-sortIcon field="name"></p-sortIcon>
      </th>
      <th pSortableColumn="graphStatus">
        Status <p-sortIcon field="graphStatus"></p-sortIcon>
      </th>
      <th>Actions</th>
    </tr>
  </ng-template>

  <!-- Table Body -->
  <ng-template pTemplate="body" let-rule>
    <tr>
      <td>
        <a
          href="javascript:void(0)"
          class="rule-name-hitbox"
          (click)="expandedRuleId = expandedRuleId === rule.id ? null : rule.id"
        >
          {{ rule.name }}
        </a>
      </td>
      <td>
        <span
          [ngClass]="{
            'status-finalized': rule.graphStatus === 'FINALIZED',
            'status-draft': rule.graphStatus === 'DRAFT'
          }"
        >
          {{ rule.graphStatus === 'FINALIZED' ? 'Finalized' : 'Draft' }}
        </span>
      </td>
      <td>
        <p-button
          id="edit-rule-button"
          icon="pi pi-pencil"
          class="p-button-text p-button-sm"
          (click)="editRule(rule.id)"
          title="Edit"
        ></p-button>
        <p-button
          id="delete-rule-button"
          icon="pi pi-trash"
          class="p-button-text p-button-sm p-button-danger"
          title="Delete"
          [style]="{ 'background-color': '#f44336', 'border-color': '#f44336', 'color': '#fff' }"
          (click)="deleteRule(rule.id)"
        ></p-button>
      </td>
    </tr>
    <tr *ngIf="expandedRuleId === rule.id">
      <td colspan="3" class="rule-description-row">
        <div class="rule-description">
          {{ rule.description }}
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- MARK: Create Rule Modal -->
<p-dialog
  header="Create new Rule"
  [(visible)]="showCreateRule"
  [modal]="true"
  [closable]="false"
  [style]="{ width: '450px' }"
>
<form (ngSubmit)="createRule()" class="p-fluid">
  <!-- Neuer Regelname -->
  <div class="form-field">
    <label for="rule-name">Name</label>
    <input name="rule-name" type="text" [(ngModel)]="newRule.name" placeholder="Demo Rule" class="form-input"
           required>
  </div>

  <!-- Neue Regelbeschreibung -->
  <div class="field mb-3">
    <label for="rule-description" class="font-bold mb-1">Beschreibung</label>
    <textarea
      id="rule-description"
      name="rule-description"
      [(ngModel)]="newRule.description"
      placeholder="Beschreibe die Regel..."
      class="form-input w-full"
      rows="3"
      required
      autocomplete="off"
    ></textarea>
  </div>

    <!-- Form Actions -->
    <div class="flex justify-content-end gap-2 mt-3">
      <p-button
        id="save-button"
        label="Save"
        icon="pi pi-save"
        type="submit"
      ></p-button>
      <p-button
        id="cancel-button"
        label="Cancel"
        icon="pi pi-times"
        class="p-button-secondary"
        type="button"
        [style]="{ 'background-color': '#f44336', 'border-color': '#f44336', 'color': '#fff' }"
        (click)="closeCreateRuleModal()"
      ></p-button>
    </div>
  </form>
</p-dialog>
