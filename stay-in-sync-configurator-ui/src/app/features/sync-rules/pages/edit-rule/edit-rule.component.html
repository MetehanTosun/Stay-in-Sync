<!-- MARK: Page Header -->
<div class="page-header">
  <p-button class="return-button" (click)="goBack()">
    Back to Rules
  </p-button>
  <h2>
    Rule Editor - {{ ruleName }}
    <p-button class="config-button" (click)="openRuleConfiguration()">
      <span class="pi pi-cog"></span>
    </p-button>
  </h2>

  <!-- MARK: Toolbar -->
  <div class="node-selection-indicator" *ngIf="selectedNodeType">
    Selected: {{ selectedNodeType }} - Click on canvas to place
  </div>
  <p-toolbar class="toolbar">
    <!-- Add Node Button -->
    <div class="node-palette-trigger-wrapper">
      <p-button class="node-palette-button" (click)="openMainNodePalette()">
        Add Node
      </p-button>
      <div #nodePalette srClickOutside (srClickOutside)="closeNodePalette()">
        <app-node-palette [showMainNodePalette]="showMainNodePalette" [position]="nodePalettePosition"
          (nodeSelected)="onNodeSelected($event)">
        </app-node-palette>
      </div>
    </div>

    <!-- Save Graph Button -->
    <p-button class="save-graph-button" (click)="canvasFacade.saveGraph()">
      <i class="pi pi-save"></i>
      Save Graph
    </p-button>
  </p-toolbar>
</div>

<!-- MARK: Main Body -->
<!-- Graph Canvas -->
<div class="vflow-wrapper" #vflowWrapper>
  <app-vflow-canvas (canvasClick)="onCanvasClick($event)" (canvasRightClick)="onCanvasRightClick($event)"
    (suggestionSelected)="onNodeSelected($event)" (graphErrors)="graphErrors = $event">
  </app-vflow-canvas>
</div>

<!-- Error Panel -->
<app-error-panel [errors]="graphErrors" (errorClicked)="onErrorClicked($event)"></app-error-panel>

<!-- MARK: Modals -->
<!-- Provider Modal -->
<app-set-json-path-modal [(visible)]="showProviderModal" (visibleChange)="showProviderModal = $event"
  (providerCreated)="onProviderCreated($event)" (modalsClosed)="onModalsClosed()">
</app-set-json-path-modal>

<!-- Constant Modal -->
<app-set-constant-value-modal [(visible)]="showConstantModal" (visibleChange)="showConstantModal = $event"
  (constantCreated)="onConstantCreated($event)" (modalsClosed)="onModalsClosed()">
</app-set-constant-value-modal>

<!-- Schema Modal -->
<app-set-schema-modal [(visible)]="showSchemaModal" (visibleChange)="showSchemaModal = $event"
  (save)="onSchemaCreated($event)" (modalsClosed)="onModalsClosed()">
</app-set-schema-modal>

<!-- Rule Configuration Modal -->
<app-set-rule-configuration-modal [(visible)]="showConfigModal" [ruleName]="ruleName" [ruleDescription]="ruleDescription"
  (visibleChange)="showConfigModal = $event" (close)="onModalsClosed()" (save)="onRuleConfigurationSaved($event)">
</app-set-rule-configuration-modal>
