<p-button label="Create new Transformation" (click)="openCreateDialog()"></p-button>
<p-table *ngIf="transformations && transformations.length > 0" [value]="transformations" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'" [style]="{'min-height': '30rem'}">
  <ng-template pTemplate="header">
    <tr>
      <th>Name</th>
      <th>Status</th>
      <th>Transformation Rule</th>
      <th>Add/Remove</th>
    </tr>
    <tr>
      <th>
        <p-columnFilter type="text" field="script.name" placeholder="Search by name"
                        ariaLabel="Filter Name"></p-columnFilter>
      </th>
      <th>
        <p-columnFilter field="deploymentStatus" matchMode="equals" [showMenu]="false">
          <ng-template #filter let-filter="filterCallback">
            <p-select [(ngModel)]="selectedStatus" [options]="statusOptions"
                      (onChange)="filter($event.value)"
                      placeholder="Select One"
                      [showClear]="true"
                      [style]="{ 'min-width': '12rem' }">
              <ng-template let-option #item>
                <app-job-status-tag [status]="option"></app-job-status-tag>
              </ng-template>
            </p-select>
          </ng-template>
        </p-columnFilter>
      </th>
      <th></th>
      <th>
          Added: <p-columnFilter type="boolean" field="added"></p-columnFilter>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowData>
    <tr>
      <td>{{ rowData.script.name }}</td>
      <td>
        <app-job-status-tag [status]="rowData.deploymentStatus"></app-job-status-tag>
      </td>
      <td>
        <ng-container *ngIf="rowData.transformationRule; else addRuleBtn">
          {{ rowData.transformationRule }}
        </ng-container>
        <ng-template #addRuleBtn>
          <p-button label="addRule" (click)="addRule(rowData)"></p-button>
        </ng-template>
      </td>
      <td>
      </td>
      <td>
        <p-button
          [label]="rowData.added ? 'Remove' : 'Add'"
          [class]="rowData.added ? 'p-button-rounded p-button-text w-24' : 'p-button-rounded p-button-text w-24'"
          [style]="rowData.added ? {'width': '8rem', 'background-color': '#d32f2f', 'border': '#d32f2f' } : {'width': '8rem'}"
          [disabled]=" !rowData.script"
          (click)="( !rowData.script) ? showMissingFieldsMessage() : (rowData.added ? remove(rowData) : add(rowData))">
        </p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<div *ngIf="!transformations || transformations.length === 0" class="no-transformations">
  <p>There are no available Transformations. Please create a new one.</p>
</div>

<p-dialog
  header="New Transformation"
  [(visible)]="displayCreateDialog"
  (onHide)="cancelCreateTransformationDialog()"
  [modal]="true"
  [style]="{ width: '50vw', maxWidth: '20vw', minHeight: '20vw' }">
  <div class="p-fluid">
    <div class="p-field">
      <label for="name">Name</label>
      <input id="name" type="text" pInputText [(ngModel)]="newTransformation.name"/>
    </div>
    <div class="p-field">
      <label for="description">Description</label>
      <input id="description" type="text" pInputText [(ngModel)]="newTransformation.description"/>
    </div>
    <p-button label="Create" (click)="createTransformationShell()"></p-button>
  </div>
</p-dialog>

<p-dialog
  header="Select Rule"
  [(visible)]="displayRuleSelectionDialog"
  (onHide)="cancelRuleSelectionDialog()"
  [modal]="true"
  [style]="{ width: '50vw', maxWidth: '50vw', minHeight: '40vw' }"
>
  <app-transformation-rule-selection (closeDialog)="displayRuleSelectionDialog = false"
                                     [transformationId]="transformationId"></app-transformation-rule-selection>
</p-dialog>

<p-dialog
  header="Select Script"
  [(visible)]="displayScriptSelectionDialog"
  (onHide)="cancelScriptSelectionDialog()"
  [modal]="true"
  [style]="{ width: '50vw', maxWidth: '50vw', minHeight: '40vw' }"
>
  <app-transformation-script-selection (closeDialog)="displayScriptSelectionDialog = false"
                                       [transformationId]="transformationId"
                                       (transformationUpdated)="loadTransformationsFromBackend()"></app-transformation-script-selection>
</p-dialog>


