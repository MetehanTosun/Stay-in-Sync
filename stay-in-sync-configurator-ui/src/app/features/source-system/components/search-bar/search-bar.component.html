<!--
  Search Bar Component
  Provides a comprehensive search input with loading indicators, clear functionality,
  and accessibility features. Supports real-time search with debouncing and
  various configuration options.
-->
<div class="search-bar-container" 
     [formGroup]="searchForm"
     role="search" 
     [attr.aria-label]="'Search functionality'"
     [attr.aria-describedby]="'search-help-' + componentId">
  
  <!-- Main search input wrapper with icon, input, and action buttons -->
  <div class="search-input-wrapper">
    <!-- Search icon displayed when no search term is entered -->
    <i [class]="searchIconClasses + ' search-icon'" 
       *ngIf="!hasSearchTerm"
       [attr.aria-hidden]="true">
    </i>
    
    <!-- Primary search input field with comprehensive accessibility attributes -->
    <input 
      pInputText 
      type="text" 
      formControlName="searchTerm"
      [placeholder]="placeholderText"
      (input)="onSearchInput($event)"
      (change)="onSearchInputChange($event)"
      (paste)="onSearchPaste($event)"
      (keydown)="onKeyDown($event)"
      class="search-input"
      [attr.aria-label]="placeholderText"
      [attr.aria-describedby]="'search-help-' + componentId + ' search-status-' + componentId"
      [attr.aria-expanded]="hasSearchTerm"
      [attr.aria-controls]="'search-results-' + componentId"
      [attr.aria-live]="hasSearchTerm ? 'polite' : 'off'"
      [attr.aria-atomic]="true"
      [attr.aria-relevant]="'additions removals'"
      [attr.aria-busy]="loading"
      [attr.aria-invalid]="false"
      [attr.aria-required]="false"
      role="searchbox"
      autocomplete="off"
      spellcheck="false"
      [title]="getKeyboardShortcutsHelp()"
      [attr.data-testid]="'search-input'"
    />
    
    <!-- Loading indicator with spinner and optional text -->
    <div class="loading-container" 
         *ngIf="loading && config.showLoadingIndicator"
         [attr.aria-label]="getLoadingDisplayText()"
         [attr.aria-live]="'polite'"
         role="status">
      <p-progressSpinner 
        [style]="{width: '20px', height: '20px'}" 
        strokeWidth="2"
        animationDuration=".5s"
        class="loading-spinner"
        [attr.aria-label]="'Loading search results'"
      ></p-progressSpinner>
      <span *ngIf="showLoadingText" 
            class="loading-text" 
            [attr.aria-live]="'polite'">
        {{ loadingText }}
      </span>
    </div>
    
    <!-- Clear button to remove current search term -->
    <button 
      pButton 
      type="button" 
      icon="pi pi-times" 
      class="p-button-text p-button-rounded clear-button"
      *ngIf="hasSearchTerm && config.showClearButton"
      (click)="onClearSearch()"
      (keydown.enter)="onClearSearch()"
      (keydown.space)="onClearSearch()"
      [attr.aria-label]="'Clear search term'"
      [attr.aria-describedby]="'clear-help-' + componentId"
      title="Clear search (or press Escape)"
      tabindex="0"
      role="button"
      [attr.aria-pressed]="false"
      [attr.data-testid]="'clear-search-button'"
    ></button>
    
    <!-- Optional search submit button -->
    <button 
      pButton 
      type="button" 
      icon="pi pi-search" 
      class="p-button-text p-button-rounded search-button"
      *ngIf="config.showSearchButton"
      (click)="onSearchSubmit()"
      [attr.aria-label]="'Submit search'"
      [disabled]="!hasSearchTerm || loading"
      title="Search"
      role="button"
      [attr.aria-pressed]="false"
      [attr.data-testid]="'submit-search-button'"
    ></button>
  </div>
  
  <!-- Search results count display -->
  <div 
    *ngIf="resultCount !== undefined && hasSearchTerm" 
    class="search-results-count"
    [attr.id]="'search-results-' + componentId"
    [attr.aria-live]="'polite'"
    [attr.aria-atomic]="true"
    role="status"
    [attr.data-testid]="'search-results-count'"
  >
    <small class="result-count-text">{{ resultCountText }}</small>
  </div>
  
  <!-- Advanced search options for case sensitivity and regex -->
  <div class="search-options" 
       *ngIf="config.enableRegex || config.caseSensitive !== undefined"
       role="group"
       [attr.aria-label]="'Search options'">
    <div class="search-toggle-options">
      <!-- Case sensitivity toggle option -->
      <div class="toggle-option" *ngIf="config.caseSensitive !== undefined">
        <label class="toggle-label">
          <input 
            type="checkbox" 
            [checked]="config.caseSensitive"
            (change)="config.caseSensitive = !config.caseSensitive"
            class="toggle-checkbox"
            [attr.aria-label]="'Case sensitive search'"
          />
          <span class="toggle-text">Case sensitive</span>
        </label>
      </div>
      
      <!-- Regular expression search toggle option -->
      <div class="toggle-option" *ngIf="config.enableRegex">
        <label class="toggle-label">
          <input 
            type="checkbox" 
            [checked]="config.enableRegex"
            (change)="config.enableRegex = !config.enableRegex"
            class="toggle-checkbox"
            [attr.aria-label]="'Regular expression search'"
          />
          <span class="toggle-text">Regex</span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- Accessibility help text for screen readers -->
  <div class="sr-only" 
       [attr.id]="'search-help-' + componentId"
       role="tooltip">
    Search input field. Type your search term and press Enter to search, or use Escape to clear.
    {{ getKeyboardShortcutsHelp() }}
  </div>
  
  <!-- Clear button help text for screen readers -->
  <div class="sr-only" 
       [attr.id]="'clear-help-' + componentId"
       role="tooltip">
    Clear button. Press Enter or Space to clear the current search term.
  </div>
  
  <!-- Live status updates for screen readers -->
  <div class="sr-only" 
       [attr.aria-live]="'polite'"
       [attr.aria-atomic]="true"
       role="status">
    <span *ngIf="hasSearchTerm && !loading">
      Search active. {{ resultCountText }}
    </span>
    <span *ngIf="loading">
      Searching...
    </span>
  </div>
</div> 