<!--
  Source System Base Component
  Main view for managing source systems including listing, searching, creating, and deleting.
  Provides comprehensive search functionality with highlighting and responsive design.
-->

  <!--
    Table of source systems with pagination and action buttons
  -->
<div style="height: 55rem">

  <p-table [value]="systems" [loading]="loading" [paginator]="true"
           [paginator]="true"
           paginatorPosition="bottom"
           [rows]="10"
           [scrollable]="true"
           scrollHeight="flex">
    <ng-template #caption>
      <div class="flex items-center justify-between">
        <span class="text-xl font-bold">Source Systems</span>
        <button pButton type="button" label="Create Source System" icon="pi pi-plus" (click)="openCreate()"></button>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 25%;">
          <div class="column-header">
            <span>Name</span>
          </div>
        </th>
        <th style="width: 25%;">
          <div class="column-header">
            <span>API URL</span>
          </div>
        </th>
        <th style="width: 25%;">
          <div class="column-header">
            <span>Description</span>
          </div>
        </th>
        <th style="width: 25%;">
          <div class="column-header">
            <span>Actions</span>
          </div>
        </th>
      </tr>
      <tr>
        <th>
          <p-columnFilter type="text" field="name" matchMode="contains" placeholder="Search by name" [showMenu]="false"
                          ariaLabel="Filter Name"></p-columnFilter>
        </th>
        <th>
          <p-columnFilter type="text" field="apiUrl" matchMode="contains" placeholder="Search by address"
                          ariaLabel="Filter Name"></p-columnFilter>
        </th>
        <th></th>
        <th>
        </th>
      </tr>
    </ng-template>

    <!-- Table body with search highlighting and action buttons -->
    <ng-template pTemplate="body" let-system let-rowIndex="rowIndex">
      <tr [class.search-result]="isSearchActive">
        <td>
          <div class="system-name-cell">
            <div class="system-name" [innerHTML]="getHighlightedText(system.name, 'name')"></div>
            <div class="system-meta" *ngIf="isSearchActive">
            </div>
          </div>
        </td>
        <td>
          <div class="api-url-cell">
            <div class="api-url" [innerHTML]="getHighlightedText(system.apiUrl, 'url')"></div>
            <div class="api-type" *ngIf="system.apiType">
              <span class="api-type-badge">{{ system.apiType }}</span>
            </div>
          </div>
        </td>
        <td>
          <div class="description-cell">
            <div class="description-text" [innerHTML]="getHighlightedText(system.description, 'description')"></div>
          </div>
        </td>
        <td>
          <div class="actions-cell">
            <!-- Manage button to view and edit source system details -->
            <button pButton
                    type="button"
                    label="Manage"
                    class="p-button-text p-button-sm"
                    (click)="manageSourceSystem(system)"
                    [title]="'Manage ' + system.name">
            </button>
            <!-- Delete button to remove source system -->
            <button pButton
                    type="button"
                    icon="pi pi-trash"
                    class="p-button-text p-button-sm p-button-danger"
                    (click)="deleteSourceSystem(system)"
                    [title]="'Delete ' + system.name">
            </button>

          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Empty state message when no data is available -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4">
          <div class="empty-state">
            <div class="empty-icon">
              <i class="pi pi-search" *ngIf="isSearchActive"></i>
              <i class="pi pi-database" *ngIf="!isSearchActive"></i>
            </div>
            <div class="empty-message">
              <h4>{{ getEmptyMessage() }}</h4>
              <p *ngIf="isSearchActive">
                No source systems found matching "{{ searchTerm }}"
              </p>
              <p *ngIf="!isSearchActive">
                No source systems available. Create your first source system to get started.
              </p>
            </div>
            <div class="empty-actions" *ngIf="!isSearchActive">
              <button pButton
                      type="button"
                      label="Create Source System"
                      icon="pi pi-plus"
                      (click)="openCreate()">
              </button>
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Shared confirmation dialog for delete -->
<app-confirmation-dialog
  [(visible)]="showConfirmationDialog"
  [data]="confirmationData"
  (confirmed)="onConfirmationConfirmed()"
  (cancelled)="onConfirmationCancelled()">
</app-confirmation-dialog>

<!-- Create Source System Dialog -->
<app-create-source-system
  [(visible)]="showCreateDialog"
  (visibleChange)="onCreateDialogClose($event)">
</app-create-source-system>
