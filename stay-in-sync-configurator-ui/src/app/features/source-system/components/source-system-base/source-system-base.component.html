<!--
  -------------------------------------------------------------------------------------------------
  Base view: list, create, and delete source systems
  -------------------------------------------------------------------------------------------------
-->
<p-card>
  <p-toolbar>
    <div class="p-toolbar-group-left">
      <h3>Source Systems</h3>
    </div>
    <div class="p-toolbar-group-right">
      <button pButton type="button" label="Create Source System" icon="pi pi-plus" (click)="openCreate()"></button>
    </div>
  </p-toolbar>

  
  <!--
    Table of source systems with pagination and action buttons
  -->
  <p-table [value]="systems" [loading]="loading" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'">
    <ng-template pTemplate="header">
      <tr>
        <th>Name</th>
        <th>API URL</th>
        <th>Description</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-system>
      <tr>
        <td>{{ system.name }}</td>
        <td>{{ system.apiUrl }}</td>
        <td>{{ system.description }}</td>
        <td>
          <!-- Manage Source System -->
          <button pButton type="button" label="Manage" class="p-button-text" (click)="viewSourceSystem(system)"></button>
          <!-- Delete Source System -->
          <button pButton type="button" icon="pi pi-trash" class="p-button-text" (click)="deleteSourceSystem(system)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-message *ngIf="errorMsg" severity="error" text="{{ errorMsg }}"></p-message>
</p-card>

<!--
  Dialog component for creating or editing a source system
-->
<app-create-source-system
  [(visible)]="showCreateDialog"
  [sourceSystem]="selectedSystem"
  (visibleChange)="onCreateDialogClose($event)">
</app-create-source-system>

<!--
  Detail dialog for metadata, API headers, and endpoints management of a selected system
-->
<p-dialog header="Manage Source System" [(visible)]="showDetailDialog" [modal]="true" [style]="{ width: '80vw', height: '80vh' }" (onHide)="closeDetailDialog()">
  <ng-container *ngIf="selectedSystem">
    <!--
      Metadata edit form for selected source system
    -->
    <form [formGroup]="metadataForm" (ngSubmit)="saveMetadata()">
      <div style="margin-bottom: 2rem;"></div>
      <!-- Metadata edit form -->
      <h3 style="margin-bottom: 1.5rem;">Metadata</h3>

      <div class="p-col-12 p-md-3" style="margin-bottom: 1.5rem;">
        <label for="metaName">Name</label>
        <input id="metaName" pInputText formControlName="name" />
      </div>
      
      <div class="p-col-12 p-md-3" style="margin-bottom: 1.5rem;">
        <label for="metaUrl">API URL</label>
        <input id="metaUrl" pInputText formControlName="apiUrl" />
      </div>
      
      <div class="p-col-12 p-md-3" style="margin-bottom: 1.5rem;">
        <label for="metaDesc" class="p-d-block">Description</label>
        <textarea id="metaDesc" pInputTextarea formControlName="description" rows="3" class="p-inputtextarea p-d-block"></textarea>
      </div>
      
   
      <div style="margin-bottom: 2rem;"></div>
      
      <div class="p-col-12 p-md-3 p-d-flex p-ai-end p-jc-end">
        <button pButton label="Save Metadata"
                type="submit"
                [disabled]="metadataForm.invalid"></button>
      </div>
    </form>
    <div class="p-grid p-m-2">
      <div class="p-col-12 p-md-6">
        <!--
          Section: Manage API request headers for the selected system
        -->
        <p-card>
          <h4>API Headers</h4>
          <app-manage-api-headers [syncSystemId]="selectedSystem!.id!"></app-manage-api-headers>
        </p-card>
      </div>
      <div class="p-col-12 p-md-6">
        <!--
          Section: Manage endpoints for the selected system
        -->
        <p-card>
          <h4>Endpoints</h4>
          <app-manage-endpoints [sourceSystemId]="selectedSystem!.id!"></app-manage-endpoints>
        </p-card>
      </div>
    </div>
  </ng-container>
</p-dialog>