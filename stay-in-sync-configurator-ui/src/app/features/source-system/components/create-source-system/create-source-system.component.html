<form #sourceForm="ngForm" (ngSubmit)="save()">
  <div class="p-fluid">
    <div class="p-field" style="margin-bottom: 1rem;">
      <label for="name">Name</label>
      <input
        id="name"
        type="text"
        pInputText
        name="name"
        [(ngModel)]="source.name"
        required
        placeholder="e.g. My Production Line API"
      />
      <small *ngIf="sourceForm.controls['name']?.invalid && sourceForm.controls['name']?.touched" class="p-error">
        Name is required.
      </small>
    </div>

    <div class="p-field" style="margin-bottom: 1rem;">
      <label for="type">Source Type</label>
      <p-dropdown
        id="type"
        name="type"
        [options]="sourceTypeOptions"
        [(ngModel)]="selectedSourceType"
        placeholder="Select a Type"
        optionLabel="label"
        optionValue="value"
        (onChange)="onTypeChange()"
        required>
      </p-dropdown>
      <small *ngIf="sourceForm.controls['type']?.invalid && sourceForm.controls['type']?.touched" class="p-error">
        Source Type is required.
      </small>
    </div>

    <div *ngIf="selectedSourceType === 'AAS'" class="p-field" style="margin-bottom: 1rem;">
      <label for="aas">Choose AAS Instance</label>
      <p-dropdown
        id="aas"
        name="aasId"
        [options]="aasList"
        [(ngModel)]="source.aasId"
        placeholder="Select an AAS Instance"
        optionLabel="name"
        optionValue="id"
        [filter]="true"
        filterBy="name"
        [showClear]="true"
        [required]="selectedSourceType === 'AAS'">
      </p-dropdown>
      <small *ngIf="selectedSourceType === 'AAS' && sourceForm.controls['aasId']?.invalid && sourceForm.controls['aasId']?.touched" class="p-error">
        AAS Instance is required for AAS type.
      </small>
      <div *ngIf="isLoadingAas && selectedSourceType === 'AAS'">Loading AAS instances...</div>
    </div>

    <div *ngIf="selectedSourceType === 'REST'" class="p-field" style="margin-bottom: 1rem;">
      <label for="endpoint">Endpoint URL</label>
      <input
        id="endpoint"
        type="text"
        pInputText
        name="endpoint"
        [(ngModel)]="source.endpoint"
        placeholder="e.g. https://api.example.com/data"
        [required]="selectedSourceType === 'REST'"
      />
      <small *ngIf="selectedSourceType === 'REST' && sourceForm.controls['endpoint']?.invalid && sourceForm.controls['endpoint']?.touched" class="p-error">
        Endpoint URL is required for REST type.
      </small>
    </div>
  </div>

  <div class="form-actions" style="text-align: right; margin-top: 2rem;">
    <button
      pButton
      type="button"
      label="Cancel"
      icon="pi pi-times"
      (click)="cancel()"
      class="p-button-text p-mr-2">
    </button>
    <button
      pButton
      type="submit"
      label="Create"
      icon="pi pi-check"
      [disabled]="sourceForm.invalid">
    </button>
  </div>
</form>