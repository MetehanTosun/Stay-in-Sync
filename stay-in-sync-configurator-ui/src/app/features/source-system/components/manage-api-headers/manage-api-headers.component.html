<!-- Manage API Headers: form for adding/updating headers and a table to list them -->
<div class="">
  <p-toast key="headers"></p-toast>
  <form [formGroup]="form" class="inline-flex gap-10 p-4 mt-1!">
    <p-floatlabel variant="on">
      <p-select
        id="headerType"
        [options]="allowedHeaderTypes"
        optionLabel="label"
        optionValue="value"
        placeholder="Select type"
        formControlName="headerType">
      </p-select>
      <label for="headerType">Type</label>
    </p-floatlabel>
    <p-floatlabel  variant="on">
      <input id="headerName" pInputText formControlName="headerName"/>
      <label for="headerName">Name</label>
    </p-floatlabel>
    <p-floatlabel  variant="on" *ngIf="allowValues">
      <input id="headerValue" pInputText formControlName="headerValue"/>
      <label for="headerValue">Value</label>
    </p-floatlabel>
    <button pButton type="button" [label]="editing ? 'Update Header' : 'Add Header'" [disabled]="form.invalid" (click)="addHeader()"></button>
    <button *ngIf="editing" pButton type="button" class="p-button-text" label="Cancel" (click)="cancelEdit()"></button>
    <button *ngIf="isAas" pButton type="button" class="p-ml-2 p-button-text" (click)="onRetest.emit()"></button>
    <span *ngIf="editing" class="p-ml-2" style="align-self:center;color:var(--text-color-secondary)">Editing</span>
  </form>
</div>

<div class="!mt-5 " style="height: 50rem">
  <p-table [value]="headers"
           [paginator]="true"
           paginatorPosition="bottom"
           [rows]="10"
           [scrollable]="true"
           scrollHeight="flex"
           [responsiveLayout]="'scroll'">
    <ng-template pTemplate="header">
      <tr>
        <th>Header Name</th>
        <th>Header Type</th>
        <th *ngIf="allowValues">Value</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-h>
      <tr>
        <td>{{ h.headerName }}</td>
        <td>{{ h.headerType }}</td>
        <td *ngIf="allowValues">{{ h.values?.[0] }}</td>
        <td>
          <button pButton type="button" icon="pi pi-trash" class="p-button-text p-button-danger" (click)="deleteHeader(h)"></button>
          <button pButton type="button" icon="pi pi-pencil" class="p-button-text" (click)="editHeader(h)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <div *ngIf="isAas" class="p-mb-3" style="color:#555;">
    Accept/Content-Type werden bei AAS automatisch gesetzt und sind hier ausgeblendet.
  </div>
</div>

<app-confirmation-dialog
  [(visible)]="showConfirmationDialog"
  [data]="confirmationData"
  (confirmed)="onConfirmationConfirmed()"
  (cancelled)="onConfirmationCancelled()">
</app-confirmation-dialog>
