<div class="script-editor-container p-m-2">
  <div *ngIf="isLoading" class="loading-overlay">
    <p-progressSpinner strokeWidth="4"></p-progressSpinner>
    <p>Loading SyncJob Context...</p>
  </div>

  <p-splitter
    [style]="{ height: '70vh' }"
    styleClass="p-mb-3"
    [panelSizes]="[70, 30]"
    [class.blurred]="isLoading"
  >
    <ng-template pTemplate pTemplateType="panel" let-pane>
      <div class="col-main-editor p-fluid">
        <p-panel header="TypeScript Transformation Script" styleClass="h-full">
          <div>
            <ngx-monaco-editor
              style="width: 100%; height: 100%"
              [options]="editorOptions"
              [(ngModel)]="code"
              (onInit)="onEditorInit($event)"
            >
            </ngx-monaco-editor>
          </div>
          <ng-template pTemplate="footer">
            <div class="p-d-flex p-jc-between">
              <p-button
                label="Check Script"
                icon="pi pi-check-square"
                (click)="checkScript()"
                [disabled]="isLoading || !syncJobId"
                class="p-button-secondary p-mr-2"
              ></p-button>
              <p-button
                label="Run Script"
                icon="pi pi-play"
                (click)="runScript()"
                [disabled]="isLoading || !syncJobId"
              ></p-button>
            </div>
          </ng-template>
        </p-panel>
      </div>
    </ng-template>
    <ng-template pTemplate pTemplateType="panel" let-pane>
      <div class="col-side-panel p-fluid" style="height: 100%">
        <!-- New component for SyncJob specific info -->
        <app-sync-job-context-panel [syncJobData]="currentSyncJobContextData">
        </app-sync-job-context-panel>
      </div>
    </ng-template>
  </p-splitter>

  <p-accordion [multiple]="true" [class.blurred]="isLoading">
    <p-accordionTab
      header="Script Analysis & Pre-checks"
      [selected]="false"
      [disabled]="isLoading"
    >
      <p-messages
        [(value)]="analysisMessages"
        [enableService]="false"
        [closable]="true"
      ></p-messages>
      <!-- ... analysisResults display ... -->
    </p-accordionTab>
    <p-accordionTab
      header="Execution Output"
      [selected]="true"
      [disabled]="isLoading"
    >
      <pre *ngIf="executionResult">{{ executionResult | json }}</pre>
      <pre *ngIf="executionError" style="color: red">{{
        executionError | json
      }}</pre>
      <!-- ... default message ... -->
    </p-accordionTab>
  </p-accordion>
</div>
