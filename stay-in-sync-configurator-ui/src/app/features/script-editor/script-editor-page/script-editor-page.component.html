<p-confirmDialog [style]="{width: '50vw'}"></p-confirmDialog>
<div *ngIf="isLoading" class="loading-overlay">
  <p-progressSpinner strokeWidth="4"></p-progressSpinner>
  <p>{{ loadingMessage }}</p>
</div>


<div class="script-editor-layout" [class.blurred]="isLoading">
  <!-- ALIGNED HEADER -->
  <div class="page-header">
    <!-- Left Group: Back Button & Title -->
    <div class="flex align-items-center gap-3">
      <p-button
        icon="pi pi-arrow-left"
        (click)="goBack()"
        styleClass="p-button-secondary p-button-text"
        pTooltip="Back to Scripts"
        tooltipPosition="bottom"
      ></p-button>

      <p-inplace #inplace (onActivate)="onActivate()" styleClass="script-title-inplace">
        <ng-template #display>
          <div class="flex align-items-center gap-2">
            <i class="pi pi-file-edit"></i>
            <span class="text-xl font-bold">{{ scriptPayload?.name }}</span>
          </div>
        </ng-template>
        <ng-template #content let-closeCallback="closeCallback">
          <div class="p-inputgroup">
            <input type="text" [(ngModel)]="scriptPayload!.name" pInputText autofocus (keyup.enter)="onSave(closeCallback)"/>
            <p-button icon="pi pi-times" styleClass="p-button-danger" (click)="onClose(closeCallback)"></p-button>
            <p-button icon="pi pi-check" styleClass="p-button-success" (click)="onSave(closeCallback)"></p-button>
          </div>
        </ng-template>
      </p-inplace>
    </div>

    <!-- Right Group: Save Button -->
    <div class="flex">
      <p-button
        label="Save Script"
        icon="pi pi-save"
        (click)="saveScript()"
        [loading]="isSaving"
        [disabled]="isLoading || isSaving || !currentTransformationId"
      ></p-button>
    </div>
  </div>

  <!-- Source System ARCs -->
  <div class="side-panel-source">
    <app-arc-management-panel
      (createArc)="handleCreateArc($event)"
      (cloneArc)="handleCloneArc($event)"
      (editArc)="handleEditArc($event)"
      (deleteArc)="handleDeleteArc($event)"
      (createAasArc)="handleCreateAasArc($event)"
      (editAasArc)="handleEditAasArc($event)"
      (deleteAasArc)="handleDeleteAasArc($event)"
    ></app-arc-management-panel>
  </div>

  <!-- Code Editor Panel -->
  <div class="main-panel">
    <ngx-monaco-editor
      style="width: 100%; height: 100%"
      [options]="editorOptions"
      [(ngModel)]="code"
      (onInit)="onEditorInit($event)"
    ></ngx-monaco-editor>
  </div>

  <!-- Target ARC Panel -->
  <div class="side-panel-target">
    <app-target-arc-panel
      *ngIf="currentTransformationId"
      [transformationId]="currentTransformationId"
    ></app-target-arc-panel>
  </div>
</div>

<app-arc-wizard
  *ngIf="isWizardVisible && wizardContext"
  [visible]="isWizardVisible"
  [context]="wizardContext"
  (onHide)="isWizardVisible = false"
  (onSaveSuccess)="handleArcSave($event)"
>
</app-arc-wizard>

<app-arc-wizard-aas
  *ngIf="isAasWizardVisible && aasWizardContext"
  [visible]="isAasWizardVisible"
  [context]="aasWizardContext"
  (onHide)="isAasWizardVisible = false"
  (onSaveSuccess)="handleAasArcSave($event)"
>
</app-arc-wizard-aas>
