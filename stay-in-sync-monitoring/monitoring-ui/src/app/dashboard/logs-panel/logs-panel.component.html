<div class="log-filters">
  <label>
    Start Time:
    <input type="datetime-local" [(ngModel)]="startTime" (change)="onFilterChange()" />
  </label>

  <label>
    End Time:
    <input type="datetime-local" [(ngModel)]="endTime" (change)="onFilterChange()" />
  </label>

  <label>
    Stream:
    <select [(ngModel)]="stream" (change)="onFilterChange()">
      <option value="stderr">stderr</option>
      <option value="stdout">stdout</option>
    </select>
  </label>

  <label>
    Level:
    <select [(ngModel)]="level" (change)="onFilterChange()">
      <option value="">All</option>
      <option value="info">Info</option>
      <option value="warn">Warn</option>
      <option value="error">Error</option>
      <option value="debug">Debug</option>
      <option value="trace">Trace</option>
    </select>
  </label>
</div>

<p-table
  [value]="filteredLogs"
  [scrollable]="true"
  scrollHeight="flex"
  class="log-table"
  [style.width]="'100%'"
  [style.table-layout]="'fixed'"
  [style.height]="'350px'"
>

  <ng-template pTemplate="header">
    <tr>
      <th>Timestamp</th>
      <th>Level</th>
      <th>Caller</th>
      <th>Message</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
     <th>
     </th>
      <th>
        <p-columnFilter type="text" field="message" placeholder="Search by message" ariaLabel="Filter Message"></p-columnFilter>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-log>
    <tr>
      <td class="timestamp">{{ log.timestamp | date: 'short' }}</td>
      <td class="level" [ngClass]="log.level">{{ log.level }}</td>
      <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ log.caller || '-' }}</td>
      <td class="message" style="white-space: normal; word-wrap: break-word; max-width: 400px;">
        {{ log.message || buildFallbackMessage(log) }}
      </td>
    </tr>
  </ng-template>
</p-table>

<ng-template #noLogs>
  <p>No logs found for the selected filters.</p>
</ng-template>
