<div class="replay-container" style="display: flex; gap: 1rem; height: 100%">
  <!-- Linke Seite: Monaco Editor mit fester Breite -->
  <section
    class="left-pane"
    style="width: 55%; display: flex; flex-direction: column"
  >
    <header
      class="pane-header"
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      "
    >
      <h2>Script (read-only)</h2>
      <button class="btn btn-secondary" (click)="onReplayClick()">
        Replay
      </button>
    </header>

    <ng-container *ngIf="!loading(); else loadingTpl">
      <ng-container *ngIf="!error(); else errorTpl">
        <ngx-monaco-editor
          [options]="{
            readOnly: true,
            language: 'javascript',
            automaticLayout: true,
            minimap: { enabled: false },
            lineNumbers: 'on'
          }"
          [ngModel]="scriptDisplay"
          style="
            flex: 1;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
          "
        >
        </ngx-monaco-editor>
      </ng-container>
    </ng-container>
  </section>

  <!-- Rechte Seite: Tabs bleiben wie vorher -->
  <section
    class="right-pane"
    style="flex: 1; display: flex; flex-direction: column"
  >
    <p-tabs>
      <p-tablist>
        <p-tab value="0">SourceData</p-tab>
        <p-tab value="1">Variables</p-tab>
        <p-tab value="2">Errors</p-tab>
        <p-tab value="3">OutputData</p-tab>
        <p-tab value="4">Logs</p-tab>
      </p-tablist>

      <p-tabpanels>
        <p-tabpanel value="0">
          <ng-container *ngIf="!loading(); else loadingTpl">
            <ng-container *ngIf="!error(); else errorTpl">
              <h3>SourceData</h3>
              <pre class="json-block">{{
                data()?.transformationResult?.sourceData | json
              }}</pre>
            </ng-container>
          </ng-container>
        </p-tabpanel>
        <p-tabpanel value="1">
          <ng-container *ngIf="!loading(); else loadingTpl">
            <ng-container *ngIf="!error(); else errorTpl">
              <h3>Variable Snapshot</h3>
              <pre class="json-block">{{ variables | json }}</pre>
              <pre class="json-block">{{ variables | json }}</pre>
            </ng-container>
          </ng-container>
        </p-tabpanel>
        <p-tabpanel value="2">
          <ng-container *ngIf="!loading(); else loadingTpl">
            <ng-container *ngIf="!error(); else errorTpl">
              <h3>Errors</h3>
              <pre class="terminal">{{ errorInfo | json }}</pre>
            </ng-container>
          </ng-container>
        </p-tabpanel>
        <p-tabpanel value="3">
          <ng-container *ngIf="!loading(); else loadingTpl">
            <ng-container *ngIf="!error(); else errorTpl">
              <h3>OutputData</h3>
              <pre class="terminal">{{ outputData | json }}</pre>
            </ng-container>
          </ng-container>
        </p-tabpanel>
        <p-tabpanel value="4">
          <ng-container *ngIf="!loading(); else loadingTpl">
            <ng-container *ngIf="!error(); else errorTpl">
              <h3>Logs</h3>
              <p-table
                [value]="logs"
                [scrollable]="true"
                scrollHeight="flex"
                class="log-table"
                [style.width]="'100%'"
                [style.table-layout]="'fixed'"
              >
                <ng-template pTemplate="header">
                  <tr>
                    <th pSortableColumn="timestamp">
                      Timestamp <p-sortIcon field="timestamp"></p-sortIcon>
                    </th>
                    <th>Level</th>
                    <th>Service</th>
                    <th>Message</th>
                  </tr>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>
                      <p-columnFilter
                        type="text"
                        field="message"
                        placeholder="Search by message"
                      ></p-columnFilter>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-log>
                  <tr>
                    <td class="timestamp">
                      {{ log.timestamp / 1000000 | date : "short" }}
                    </td>
                    <td class="level" [ngClass]="log.level">{{ log.level }}</td>
                    <td
                      style="
                        max-width: 150px;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        white-space: nowrap;
                      "
                    >
                      {{ log.service || "-" }}
                    </td>
                    <td
                      class="message"
                      style="
                        white-space: normal;
                        word-wrap: break-word;
                        max-width: 400px;
                      "
                    >
                      {{ log.message }}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </ng-container>
          </ng-container>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </section>

  <!-- Templates fÃ¼r Loading & Error -->
  <ng-template #loadingTpl>
    <p>Loading...</p>
  </ng-template>

  <ng-template #errorTpl>
    <p class="error">Error loading data</p>
  </ng-template>
</div>
