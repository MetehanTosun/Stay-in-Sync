# Default values for stay-in-sync-chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# This will set the replicaset count more information can be found here: https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/
replicaCount: 1

# This sets the container image more information can be found here: https://kubernetes.io/docs/concepts/containers/images/
image:
  repository: nginx
  # This sets the pull policy for images.
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

# This is for the secrets for pulling an image from a private repository more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
imagePullSecrets: [ ]
# This is to override the chart name.
nameOverride: ""
fullnameOverride: ""

# This section builds out the service account more information can be found here: https://kubernetes.io/docs/concepts/security/service-accounts/
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: { }
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# This is for setting Kubernetes Annotations to a Pod.
# For more information checkout: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
podAnnotations: { }
# This is for setting Kubernetes Labels to a Pod.
# For more information checkout: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
podLabels: { }

podSecurityContext: { }
# fsGroup: 2000

securityContext: { }
# capabilities:
#   drop:
#   - ALL
# readOnlyRootFilesystem: true
# runAsNonRoot: true
# runAsUser: 1000

# This is for setting up a service more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/
service:
  # This sets the service type more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types
  type: ClusterIP
  # This sets the ports more information can be found here: https://kubernetes.io/docs/concepts/services-networking/service/#field-spec-ports
  port: 80

# This block is for setting up the ingress for more information can be found here: https://kubernetes.io/docs/concepts/services-networking/ingress/
ingress:
  enabled: false
  className: ""
  annotations: { }
  # kubernetes.io/ingress.class: nginx
  # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: [ ]
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

resources: { }
# We usually recommend not to specify default resources and to leave this as a conscious
# choice for the user. This also increases chances charts run on environments with little
# resources, such as Minikube. If you do want to specify resources, uncomment the following
# lines, adjust them as necessary, and remove the curly braces after 'resources:'.
# limits:
#   cpu: 100m
#   memory: 128Mi
# requests:
#   cpu: 100m
#   memory: 128Mi

# This is to setup the liveness and readiness probes more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
livenessProbe:
  httpGet:
    path: /
    port: http
readinessProbe:
  httpGet:
    path: /
    port: http

# This section is for setting up autoscaling more information can be found here: https://kubernetes.io/docs/concepts/workloads/autoscaling/
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Additional volumes on the output Deployment definition.
volumes: [ ]
# - name: foo
#   secret:
#     secretName: mysecret
#     optional: false

# Additional volumeMounts on the output Deployment definition.
volumeMounts: [ ]
# - name: foo
#   mountPath: "/etc/foo"
#   readOnly: true

nodeSelector: { }

tolerations: [ ]

affinity: { }
core-management:
  app:
    envs:
      FLUENT_BIT_ADDRESS: fluent-bit:5171
      DB_HOST: stay-in-sync-mariadb
      DB_PASSWORD: root
      DB_USERNAME: root
      RABBITMQ_HOST: stay-in-sync-rabbitmq
core-polling-node:
  app:
    envs:
      FLUENT_BIT_ADDRESS: fluent-bit:5172
      RABBITMQ_HOST: stay-in-sync-rabbitmq
core-sync-node:
  app:
    envs:
      FLUENT_BIT_ADDRESS: fluent-bit:5173
      RABBITMQ_HOST: stay-in-sync-rabbitmq
monitoring-backend:
  app:
    envs:
      FLUENT_BIT_ADDRESS: fluent-bit:5170
      CORE_MANAGEMENT_ADDRESS: http://core-management:80
      SYNCNODE_ADDRESS: http://core-sync-node:80
      PROMETHEUS_URL: http://stay-in-sync-kube-promethe-prometheus:9090
      LOKI_URL: http://loki:3100/loki/api/v1/query_range
      GRAFANA_BASE_URL: http://grafana.stayinsync.local/d/abd0d0fc-75cf-4a29-abeb-7c96b57a1629/stayinsync-monitoring-metrics
kube-prometheus-stack:
  prometheus:
    enabled: true
    prometheusSpec:
      additionalScrapeConfigsSecret:
        enabled: true
        name: additional-scrape-configs
        key: prometheus-additional.yaml
      maximumStartupDurationSeconds: 600
      serviceMonitorSelector:
        matchExpressions:
          - key: app.kubernetes.io/managed-by
            operator: In
            values:
              - Helm
              - quarkus
      podMonitorSelector:
        matchExpressions:
          - key: app.kubernetes.io/managed-by
            operator: In
            values:
              - Helm
              - quarkus
  grafana:
    adminUser: admin
    adminPassword: admin
    service:
      type: ClusterIP
    ingress:
      enabled: true
      hosts:
        - grafana.stayinsync.local
    grafana.ini:
      security:
        allow_embedding: true
      auth.anonymous:
        enabled: true
        org_name: Main Org.
        org_role: Viewer
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
    dashboardsConfigMaps:
      stayinsync-dashboard: stayinsync-dashboard
    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
          - name: Prometheus
            type: prometheus
            access: proxy
            url: http://stay-in-sync-kube-promethe-prometheus:9090

loki:
  fullnameOverride: loki
  deploymentMode: SingleBinary
  loki:
    auth_enabled: false
    server:
      http_listen_port: 3100
    commonConfig:
      replication_factor: 1
    storage:
      type: 'filesystem'
      filesystem:
        directory: /tmp/loki
    schemaConfig:
      configs:
        - from: "2024-01-01"
          store: tsdb
          index:
            prefix: loki_index_
            period: 24h
          object_store: filesystem
          schema: v13

  singleBinary:
    replicas: 1
    persistence:
      enabled: true
      size: 10Gi
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

  read:
    replicas: 0
  backend:
    replicas: 0
  write:
    replicas: 0

  gateway:
    enabled: false

  service:
    type: ClusterIP
    port: 3100


mongodb:
  auth:
    rootUser: root
    rootPassword: "rootPassword123!"
    usernames:
      - "basyx"
      - "basyx"
    passwords:
      - "basyxUserPassword123!"
      - "basyxUserPassword123!"
    databases:
      - "aasregistry"
      - "smregistry"
  service:
    type: ClusterIP
    port: 27017

rabbitmq:
  fullnameOverride: stay-in-sync-rabbitmq
  auth:
    username: guest
    password: guest
    erlangCookie: my-erlang-cookie
  tls:
    enabled: false
  persistence:
    enabled: false
  replicaCount: 1
fluent-bit:
  fullnameOverride: fluent-bit
  config:
    inputs: |
      # TCP Input für generische Logs
      [INPUT]
          Name              tcp
          Listen            0.0.0.0
          Port              5000
          Tag               quarkus.tcp
          Format            json

      # core-management (Port 5171)
      [INPUT]
          Name        tcp
          Tag         quarkus.core-management
          Listen      0.0.0.0
          Port        5171
          Format      json

      # core-polling-node (Port 5172)
      [INPUT]
          Name        tcp
          Tag         quarkus.core-polling
          Listen      0.0.0.0
          Port        5172
          Format      json

      # core-sync-node (Port 5173)
      [INPUT]
          Name        tcp
          Tag         quarkus.core-sync
          Listen      0.0.0.0
          Port        5173
          Format      json

      # TCP Input für Monitoring-Backend
      [INPUT]
          Name        tcp
          Tag         quarkus.monitoring
          Listen      0.0.0.0
          Port        5170
          Format      json

    filters: |
      # Filter für Docker Logs
      [FILTER]
          Name              grep
          Match             docker.*
          Exclude           log ^$

      [FILTER]
          Name              modify
          Match             docker.*
          Add               service     docker
          Add               job         docker
          Add               syncJobId   empty
          Add               level       INFO
          Add               scriptId    empty

      # Labels: core-management
      [FILTER]
          Name              modify
          Match             quarkus.core-management
          Add               service     core-management
          Add               job         core-management
          Add               syncJobId   empty
          Add               scriptId    empty

      # Labels: core-polling-node
      [FILTER]
          Name              modify
          Match             quarkus.core-polling
          Add               service     core-polling-node
          Add               job         core-polling
          Add               syncJobId   empty
          Add               scriptId    empty

      # Labels: core-sync-node
      [FILTER]
          Name              modify
          Match             quarkus.core-sync
          Add               service     core-sync-node
          Add               job         core-sync

      # Modify-Filter: Labels für alle quarkus.* Logs hinzufügen
      [FILTER]
          Name    modify
          Match   quarkus.monitoring
          Add     service monitoring-backend
          Add     job     monitoring

    outputs: |
      # Loki Output
      [OUTPUT]
          Name    loki
          Match   *
          Host    loki
          Port    3100
          Labels  agent=fluent-bit
          label_keys  $service,$job,$syncJobId,$level,$scriptId,$transformationId
          Uri     /loki/api/v1/push

  containerPorts:
    http: 2020
    tcp-generic: 5000
    tcp-monitoring: 5170
    tcp-core-management: 5171
    tcp-core-polling: 5172
    tcp-core-sync: 5173

  service:
    type: ClusterIP
    ports:
      http: 2020
    extraPorts:
      - name: tcp-generic
        port: 5000
        targetPort: 5000
        protocol: TCP
      - name: tcp-monitoring
        port: 5170
        targetPort: 5170
        protocol: TCP
      - name: tcp-core-management
        port: 5171
        targetPort: 5171
        protocol: TCP
      - name: tcp-core-polling
        port: 5172
        targetPort: 5172
        protocol: TCP
      - name: tcp-core-sync
        port: 5173
        targetPort: 5173
        protocol: TCP

mariadb:
  fullnameOverride: stay-in-sync-mariadb
  primary:
    readinessProbe:
      initialDelaySeconds: 30
  auth:
    rootPassword: "root"
    database: "stayinsync_core"
  service:
    ports:
      mysql: 3306
umbrella:
  identity-and-trust-bundle:
    enabled: true
    ssi-dim-wallet-stub:
      enabled: true
      wallet:
        didHost: "ssi-dim-wallet-service"
        stubUrl: "http://ssi-dim-wallet-service"
        service:
          type: ClusterIP
          port: 80
      server:
        trustedIssuers:
          - did:web:ssi-dim-wallet-service:BPNL00000003CRHK


  dataconsumerOne:
    enabled: true
    secrets:
      edc-wallet-secret: changeme
    dataspace-connector-bundle:
      tractusx-connector:
        iatp:
          id: did:web:ssi-dim-wallet-service:BPNL00000003AZQP
          trustedIssuers:
            - did:web:ssi-dim-wallet-service:BPNL00000003CRHK
          sts:
            dim:
              url: http://ssi-dim-wallet-service/api/sts
            oauth:
              token_url: http://ssi-dim-wallet-service/oauth/token
        controlplane:
          env:
            TX_IAM_IATP_CREDENTIALSERVICE_URL: http://ssi-dim-wallet-service/api
          bdrs:
            server:
              url: http://ssi-dim-wallet-service/api/v1/directory
        dataplane:
          env:
            TX_IAM_IATP_CREDENTIALSERVICE_URL: http://ssi-dim-wallet-service/api

  tx-data-provider:
    enabled: true
    secrets:
      edc-wallet-secret: changeme
    dataspace-connector-bundle:
      tractusx-connector:
        iatp:
          id: did:web:ssi-dim-wallet-service:BPNL00000003AYRE
          trustedIssuers:
            - did:web:ssi-dim-wallet-service:BPNL00000003CRHK
          sts:
            dim:
              url: http://ssi-dim-wallet-service/api/sts
            oauth:
              token_url: http://ssi-dim-wallet-service/oauth/token
        controlplane:
          env:
            TX_IAM_IATP_CREDENTIALSERVICE_URL: http://ssi-dim-wallet-service/api
          bdrs:
            server:
              url: http://ssi-dim-wallet-service/api/v1/directory
        dataplane:
          env:
            TX_IAM_IATP_CREDENTIALSERVICE_URL: http://ssi-dim-wallet-service/api
    digital-twin-bundle:
      enabled: false




